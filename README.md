# Лабораторная: Хеш‑таблицы и бенчмарки (Extendible Hash, Perfect Hash, MinHash)

Проект реализует несколько классических структур и алгоритмов хеширования на Java с демонстрацией и JMH‑бенчмарками:

- **Extendible Hash** с **персистентными бакетами на диске** (`ExtHashBucket`) и каркасной сериализацией каталога.
- **Perfect Hash** — построение совершенной хеш‑таблицы для фиксированного множества ключей.
- **MinHash** — оценка схожести множеств по подписи минимума.
- Бенчмарки **JMH** для измерения времени вставки/поиска/удаления и т. п.
- Пример использования в `Main`.

Минимальные требования: **JDK 11+**, Gradle (есть wrapper).

---

## Как запустить

```bash
# Перейти в корень проекта
cd hash_20

# Запустить демо
./gradlew run

# Запустить бенчмарки (все JMH)
./gradlew jmh

# Запустить конкретный бенчмарк по классу (пример)
./gradlew jmh -PjmhInclude=ExtHashBenchmark

# Либо конкретный метод (регулярное выражение)
./gradlew jmh -PjmhInclude=ExtHashBenchmark.testInsert
```

При запуске Extendible Hash создаёт/использует папку **`ext-hash-data/`** для хранения содержимого бакетов на диске.

---

## Структура проекта

```
hash_20/
 ├─ build.gradle
 ├─ settings.gradle
 ├─ src/main/java/org/example/
 │   ├─ Main.java
 │   ├─ ExtendibleHash.java
 │   ├─ ExtHashBucket.java
 │   ├─ Bucket.java
 │   ├─ PerfectHash.java
 │   ├─ MinHash.java
 │   ├─ ExtHashBenchmark.java
 │   ├─ ExtHashBenchmarkRunner.java
 │   ├─ PerfectHashBenchmark.java
 │   ├─ PerfectHashBenchmarkRunner.java
 │   ├─ MinHashBenchmark.java
 │   └─ MinHashBenchmarkRunner.java
 └─ ext-hash-data/           # Файлы бакетов (создаётся при запуске)
```

---

## Описание классов

### `Main`
Мини‑демо работы `ExtendibleHash`: вставка нескольких пар, печать состояния, чтение, удаление.

### Extendible Hash

#### `ExtendibleHash<K, V>`
Реализация расширяемого хеширования (extendible hashing) с каталогом указателей на бакеты и **глобальной глубиной**. Содержит:
- API: `put`, `get`, `remove`, `printStatus`, `sizeApprox`, `saveToFile`, `loadFromFile`.
- Логику **split** при переполнении бакета, перераспределение элементов и удвоение каталога по необходимости.
- **Персистентность**: сериализует «каркас» (параметры и ссылки на файлы бакетов); сами бакеты сохраняются/читаются классом `ExtHashBucket` при каждой мутации.

#### `ExtHashBucket<K, V>`
Персистентный бакет для extendible hash:
- Поля: локальная глубина, вместимость, карта `items`, путь к файлу на диске.
- Операции: `put/get/remove/containsKey/size/isFull/getItems`.
- **Авто‑персистентность**: каждый `put/remove` сразу сериализует содержимое бакета в соответствующий `*.bin` файл в `ext-hash-data/`.
- Хранит свой `localDepth` и умеет обновляться при сплите.

#### `Bucket<K, V>`
Неперсистентный (in‑memory) бакет‑утилита (аналог для простых сценариев/референса). Предоставляет базовые операции с локальной глубиной и ёмкостью.

### Perfect Hash

#### `PerfectHash<K>`
Построение совершенной хеш‑таблицы для фиксированного набора ключей (вероятностный подбор параметров до устранения коллизий).
- Конструктор принимает `List<K> keys` и подбирает параметры.
- Операции: `indexOf(K)`, `contains(K)` и т. п.
- Подходит для неизменяемых множеств, обеспечивает O(1) поиск без коллизий.

Бенчмарк: `PerfectHashBenchmark` (создание таблицы и поиск); раннер `PerfectHashBenchmarkRunner`.

### MinHash

#### `MinHash`
Упрощённая реализация построения подписи МинХеша для множества/строки/набора токенов.
- Операции: генерация фиксированного числа хеш‑функций, построение подписи, оценка схожести.
- Применение: быстрая приблизительная оценка `Jaccard`‑сходства.

Бенчмарк: `MinHashBenchmark`; раннер `MinHashBenchmarkRunner`.

### Бенчмарки JMH

- `ExtHashBenchmark` — сценарии вставки/поиска/удаления для `ExtendibleHash` на разных объёмах.
- `PerfectHashBenchmark` — построение и поиск в совершенной таблице.
- `MinHashBenchmark` — генерация подписей и сравнение.

Каждому бенчмарку соответствует `*BenchmarkRunner` — тонкий класc, запускающий JMH из IDE/CLI.

---

## Файловая персистентность

Данные бакетов хранятся по пути `ext-hash-data/bucket_*.bin`.  
`ExtendibleHash.saveToFile(...)` сериализует метаданные (глобальная глубина, размер каталога, сопоставления с путями бакетов).  
`ExtHashBucket` обеспечивает **per‑mutation** запись содержимого на диск.

> Важно: директория `ext-hash-data/` должна быть доступна на запись. Её можно удалить для «чистой» инициализации.

---

## Как работать из IDE (IntelliJ IDEA)

1. Открыть как Gradle‑проект.
2. Выставить JDK 11+.
3. Конфигурации запуска:
    - `Application → org.example.Main` (готово из `application.mainClass`).
    - JMH: запустите `*BenchmarkRunner` (или задайте Gradle‑задачу `jmh`).

---

## Что проверять перед сдачей

- `./gradlew run` проходит без ошибок.
- `./gradlew jmh` запускает хотя бы по одному тесту для каждого из трёх блоков (ExtHash/PerfectHash/MinHash).
- Файлы появляются в `ext-hash-data/`, `printStatus()` печатает корректные глубины каталога/бакетов.

---

## Лицензия / Авторство

Учебный проект. Авторские комментарии внутри исходников.